<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Portal Kabar Temu Bakti</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Portal Berita Resmi Temu Bakti PMI Malut">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  
  <script>
    tailwind.config = { 
      theme: { 
        extend: { 
          fontFamily: { 
            sans: ['Inter', 'sans-serif'],
            serif: ['Merriweather', 'serif'] 
          } 
        } 
      } 
    }
  </script>
  <style>
    body { background-color: #f3f4f6; } /* Background sedikit lebih abu khas portal */
    
    /* Utility Clamps */
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    
    /* Loader Animation */
    .loader { border: 3px solid #e5e7eb; border-top: 3px solid #dc2626; border-radius: 50%; width: 20px; height: 20px; animation: spin 0.8s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    /* Portal Style Scrollbar */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* Active State Filter */
    .nav-pill.active { border-bottom: 2px solid #dc2626; color: #dc2626; font-weight: 700; background-color: transparent; }
    
    /* Widget Header Style */
    .widget-header { border-left: 4px solid #dc2626; padding-left: 12px; line-height: 1; }
  </style>
</head>
<body class="text-slate-800 font-sans min-h-screen flex flex-col">

  <header class="bg-white border-b border-slate-200">
      <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
          <div class="flex items-center gap-3">
             <img src="https://afbhvfhdjozvypeehgjo.supabase.co/storage/v1/object/public/TB%20PMI/logo%20temu%20bakti.png" class="h-9 w-auto">
             <div class="border-l border-slate-300 pl-3 hidden sm:block">
                <h1 class="font-extrabold text-slate-900 text-lg tracking-tight leading-none">NEWS<span class="text-red-600">PORTAL</span></h1>
                <p class="text-[10px] text-slate-500 uppercase font-semibold">Temu Bakti PMI Malut</p>
             </div>
          </div>
          <div class="text-xs font-bold text-slate-400 bg-slate-100 px-3 py-1 rounded-full">
            <span class="text-red-600 mr-1">●</span> LIVE
          </div>
      </div>
  </header>

  <div class="max-w-7xl mx-auto w-full px-0 sm:px-4 py-0 sm:py-6 flex flex-col lg:flex-row gap-0 lg:gap-8">
      
      <main class="w-full lg:w-[70%] order-2 lg:order-1 bg-white sm:bg-transparent sm:rounded-none">
          
          <div class="sticky top-0 z-30 bg-white border-b border-slate-200 shadow-sm px-4">
              <div class="flex gap-6 overflow-x-auto no-scrollbar py-3">
                  <button onclick="filterNews('SEMUA')" class="nav-pill active whitespace-nowrap text-sm font-medium text-slate-500 hover:text-red-600 transition pb-1">Terkini</button>
                  <button onclick="filterNews('Berita')" class="nav-pill whitespace-nowrap text-sm font-medium text-slate-500 hover:text-red-600 transition pb-1">Kegiatan</button>
                  <button onclick="filterNews('Opini')" class="nav-pill whitespace-nowrap text-sm font-medium text-slate-500 hover:text-red-600 transition pb-1">Opini</button>
                  <button onclick="filterNews('Sastra')" class="nav-pill whitespace-nowrap text-sm font-medium text-slate-500 hover:text-red-600 transition pb-1">Sastra</button>
                  <button onclick="filterNews('Profil')" class="nav-pill whitespace-nowrap text-sm font-medium text-slate-500 hover:text-red-600 transition pb-1">Tokoh</button>
              </div>
          </div>

          <div id="newsContainer" class="min-h-[400px] p-4 sm:p-0 sm:mt-6">
              <div class="text-center py-24">
                  <div class="loader mx-auto mb-3"></div>
                  <p class="text-slate-400 text-xs font-semibold tracking-wide animate-pulse">MEMUAT BERITA...</p>
              </div>
          </div>

      </main>

      <aside class="w-full lg:w-[30%] order-1 lg:order-2 px-4 sm:px-0 py-6 sm:py-0 space-y-6">
          
          <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
              <h3 class="font-bold text-slate-900 mb-4 widget-header text-lg">Cari Berita</h3>
              <div class="relative">
                  <input type="text" onkeyup="searchNews(this.value)" placeholder="Kata kunci..." class="w-full bg-slate-50 border border-slate-200 rounded-lg py-2.5 pl-3 pr-10 text-sm outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500 transition">
                  <i class="bi bi-search absolute right-3 top-3 text-slate-400 text-sm"></i>
              </div>
          </div>

          <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm hidden lg:block">
              <h3 class="font-bold text-slate-900 mb-4 widget-header text-lg">Topik Hangat</h3>
              <div class="flex flex-wrap gap-2">
                  <span class="px-3 py-1 bg-red-50 text-red-600 text-xs font-bold rounded hover:bg-red-100 cursor-pointer">#Jumbara2026</span>
                  <span class="px-3 py-1 bg-slate-50 text-slate-600 text-xs font-bold rounded hover:bg-slate-100 cursor-pointer">#RelawanMuda</span>
                  <span class="px-3 py-1 bg-slate-50 text-slate-600 text-xs font-bold rounded hover:bg-slate-100 cursor-pointer">#PMIMalut</span>
              </div>
          </div>

      </aside>
  </div>

  <footer class="bg-slate-900 text-white py-8 mt-auto border-t-4 border-red-600">
      <div class="max-w-7xl mx-auto px-4 text-center sm:text-left">
          <div class="flex flex-col sm:flex-row justify-between items-center">
              <div class="mb-4 sm:mb-0">
                  <h2 class="font-bold text-lg tracking-tight">TEMU BAKTI NEWS</h2>
                  <p class="text-slate-400 text-xs">Informasi Terdepan Kegiatan Palang Merah Remaja</p>
              </div>
              <p class="text-slate-500 text-xs">© 2026 Panitia Pelaksana. All Rights Reserved.</p>
          </div>
      </div>
  </footer>

  <div id="modalBerita" class="fixed inset-0 z-[100] bg-white hidden overflow-y-auto animate-fade-in">
      
      <div class="sticky top-0 bg-white/95 backdrop-blur border-b border-slate-100 px-4 py-3 flex justify-between items-center z-20">
          <button onclick="closeBerita()" class="flex items-center gap-2 text-slate-600 hover:text-red-600 transition">
              <i class="bi bi-arrow-left text-lg"></i>
              <span class="text-sm font-bold">Kembali</span>
          </button>
          <div class="flex gap-3">
             <i class="bi bi-share text-slate-400"></i>
             <i class="bi bi-bookmark text-slate-400"></i>
          </div>
      </div>

      <div class="max-w-3xl mx-auto bg-white min-h-screen">
          <div class="p-4 md:p-0 md:py-8">
              
              <div class="mb-6">
                 <span id="viewKategori" class="text-red-600 text-xs font-bold uppercase tracking-wider mb-2 block">KATEGORI</span>
                 <h1 id="viewJudul" class="text-2xl md:text-4xl font-serif font-bold text-slate-900 leading-tight mb-4">Judul Berita</h1>
                 <div class="flex items-center gap-2 text-xs text-slate-500 border-b border-slate-100 pb-6">
                    <span class="font-bold text-slate-800" id="viewPenulis">Penulis</span>
                    <span>•</span>
                    <span id="viewTanggal">Tanggal</span>
                 </div>
              </div>

              <div class="w-full aspect-video bg-slate-100 mb-8 rounded-lg overflow-hidden">
                 <img id="viewFoto" class="w-full h-full object-cover">
                 <p class="text-[10px] text-slate-400 mt-2 italic px-1">Dokumentasi Kegiatan</p>
              </div>
              
              <div id="viewIsi" class="prose prose-slate prose-lg max-w-none font-serif text-slate-800 leading-relaxed">
                  </div>
          </div>
          
          <div class="p-8 bg-slate-50 mt-12 text-center">
             <button onclick="closeBerita()" class="px-6 py-2 bg-red-600 text-white rounded-full text-sm font-bold shadow-lg shadow-red-600/30 hover:bg-red-700 transition">Tutup Berita</button>
          </div>
      </div>
  </div>

  <script>
    // ⚠️ SCRIPT BACKEND SAMA SEPERTI SEBELUMNYA ⚠️
    const GAS_NEWS_URL = "https://script.google.com/macros/s/AKfycbx693z5rUDTuE8_GrkvSeXOwt60OzIBSgQ64aMr20V00iUQz_wylG8JfMWprcfV3xOHjw/exec"; 

    let ALL_NEWS = [];
    let FILTERED_NEWS = [];
    let CURRENT_FILTER = 'SEMUA';

    window.onload = loadNews;

    async function loadNews() {
        const container = document.getElementById('newsContainer');
        try {
            const response = await fetch(GAS_NEWS_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'get_mading_public' })
            });
            const res = await response.json();

            if(res.success && res.data.length > 0) {
                ALL_NEWS = res.data;
                filterNews('SEMUA'); 
            } else {
                container.innerHTML = `<div class="text-center py-20 bg-slate-50 rounded-lg border border-dashed border-slate-300"><i class="bi bi-newspaper text-4xl text-slate-300 mb-2 inline-block"></i><p class="text-slate-500 font-bold text-sm">Belum ada berita tayang.</p></div>`;
            }
        } catch (e) {
            container.innerHTML = `<div class="text-center py-20"><p class="text-red-500 font-bold text-sm">Gagal memuat berita. Periksa koneksi internet.</p></div>`;
        }
    }

    function filterNews(kategori) {
        CURRENT_FILTER = kategori;
        
        // Style Logic untuk Navigasi Menu
        document.querySelectorAll('.nav-pill').forEach(btn => {
            btn.classList.remove('active', 'text-red-600');
            btn.classList.add('text-slate-500');
            
            // Cek text content tombol vs kategori
            let btnText = btn.innerText.toUpperCase();
            if(kategori === 'SEMUA' && btnText === 'TERKINI') {
                btn.classList.add('active');
            } else if (btnText.includes(kategori.toUpperCase())) {
                btn.classList.add('active');
            }
        });

        if(kategori === 'SEMUA') {
            FILTERED_NEWS = ALL_NEWS;
        } else {
            FILTERED_NEWS = ALL_NEWS.filter(item => item.kategori === kategori);
        }
        
        renderNews(FILTERED_NEWS);
    }

    function searchNews(keyword) {
        const term = keyword.toLowerCase();
        FILTERED_NEWS = ALL_NEWS.filter(item => 
            item.judul.toLowerCase().includes(term) || 
            item.penulis.toLowerCase().includes(term)
        );
        renderNews(FILTERED_NEWS);
    }

    function renderNews(data) {
        const c = document.getElementById('newsContainer');
        
        if(data.length === 0) {
            c.innerHTML = `<div class="py-12 text-center"><p class="text-slate-400 italic">Tidak ditemukan berita.</p></div>`;
            return;
        }

        // Logic Layout Portal: 
        // 1. Jika di 'SEMUA', item pertama jadi HEADLINE BESAR.
        // 2. Sisanya jadi LIST (Mobile) atau GRID KECIL (Desktop).
        
        const showHeadline = (CURRENT_FILTER === 'SEMUA' && document.querySelector('input').value === '');
        const [headline, ...others] = showHeadline ? data : [null, ...data];
        let html = '';

        // --- HEADLINE SECTION (Premium Look) ---
        if(showHeadline && headline) {
            html += `
            <div onclick="openBerita(${headline.id})" class="group cursor-pointer mb-8 relative rounded-xl overflow-hidden shadow-sm aspect-[16/9] md:aspect-[21/9]">
                <img src="${headline.foto_url}=s1200" class="w-full h-full object-cover group-hover:scale-105 transition duration-700">
                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>
                <div class="absolute bottom-0 left-0 p-5 md:p-8 w-full md:w-3/4">
                    <span class="inline-block bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded mb-2 shadow uppercase tracking-wider">Headline</span>
                    <h2 class="text-white text-xl md:text-3xl font-bold leading-tight mb-2 font-serif group-hover:text-red-100 transition">${headline.judul}</h2>
                    <div class="flex items-center gap-3 text-white/80 text-xs">
                        <span class="font-semibold">${headline.penulis}</span>
                        <span>•</span>
                        <span>${getTimeAgo(headline.created_at)}</span>
                    </div>
                </div>
            </div>`;
            
            // Container untuk sisa berita
            html += '<div class="flex flex-col gap-6 md:grid md:grid-cols-2 md:gap-8">';
            others.forEach(item => html += createPortalCard(item));
            html += '</div>';

        } else {
            // Layout biasa (tanpa headline)
            html += '<div class="flex flex-col gap-6 md:grid md:grid-cols-2 md:gap-8">';
            data.forEach(item => html += createPortalCard(item));
            html += '</div>';
        }

        c.innerHTML = html;
    }

    // --- CARD ALA PORTAL BERITA (Mobile: Horizontal, Desktop: Vertical) ---
    function createPortalCard(item) {
        // Tentukan warna label kategori
        let catColor = "text-blue-600";
        if(item.kategori === 'Opini') catColor = "text-purple-600";
        if(item.kategori === 'Sastra') catColor = "text-pink-600";

        return `
        <div onclick="openBerita(${item.id})" class="group cursor-pointer flex flex-row md:flex-col gap-4 md:gap-0 bg-white md:bg-transparent rounded-lg md:rounded-none p-0 border-b border-slate-100 md:border-0 pb-4 md:pb-0 last:border-0">
            
            <div class="w-[110px] h-[80px] md:w-full md:h-48 flex-shrink-0 relative rounded-lg md:rounded-xl overflow-hidden bg-slate-200 order-1 md:order-1">
                <img src="${item.foto_url}=s400" class="w-full h-full object-cover md:group-hover:scale-110 transition duration-500" loading="lazy">
                <div class="hidden md:block absolute top-2 left-2">
                     <span class="bg-white/90 backdrop-blur text-xs font-bold px-2 py-1 rounded shadow-sm ${catColor}">${item.kategori}</span>
                </div>
            </div>

            <div class="flex-1 flex flex-col justify-center order-2 md:order-2 md:mt-3">
                <span class="md:hidden text-[10px] font-bold ${catColor} uppercase mb-1 tracking-wide">${item.kategori}</span>
                
                <h3 class="text-base md:text-lg font-bold text-slate-800 leading-snug mb-1 md:mb-2 line-clamp-2 md:line-clamp-2 group-hover:text-red-600 transition font-serif">
                    ${item.judul}
                </h3>
                
                <div class="flex items-center gap-2 text-[10px] md:text-xs text-slate-400 mt-auto md:mt-0">
                    <span class="hidden md:inline font-semibold text-slate-500">${item.penulis.split(' ')[0]}</span>
                    <span class="hidden md:inline">•</span>
                    <span>${getTimeAgo(item.created_at)}</span>
                </div>
            </div>
        </div>`;
    }

    // ... (Fungsi Utility sama: openBerita, closeBerita, formatDate, getTimeAgo) ...
    function openBerita(id) {
        const item = ALL_NEWS.find(i => i.id === id);
        if(!item) return;
        document.getElementById('viewFoto').src = item.foto_url;
        document.getElementById('viewKategori').innerText = item.kategori;
        document.getElementById('viewJudul').innerText = item.judul;
        document.getElementById('viewPenulis').innerText = item.penulis;
        document.getElementById('viewTanggal').innerText = formatDate(item.created_at);
        document.getElementById('viewIsi').innerText = item.isi_berita;
        document.getElementById('modalBerita').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    function closeBerita() { document.getElementById('modalBerita').classList.add('hidden'); document.body.style.overflow = 'auto'; }
    function formatDate(iso) { if(!iso) return '-'; return new Date(iso).toLocaleDateString('id-ID', {weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'}); }
    function getTimeAgo(dateString) { const date = new Date(dateString); const now = new Date(); const diff = Math.floor((now - date)/1000); if(diff < 60) return 'Baru saja'; if(diff < 3600) return Math.floor(diff/60)+' menit lalu'; if(diff < 86400) return Math.floor(diff/3600)+' jam lalu'; return formatDate(dateString); }
  </script>
</body>
</html>
