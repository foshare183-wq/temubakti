<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Kabar Temu Bakti PMI Malut</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Portal Berita dan Dokumentasi Kegiatan Temu Bakti PMI Malut">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  
  <script>tailwind.config = { theme: { extend: { fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] } } } }</script>
  <style>
    body { background-color: #f8fafc; scroll-behavior: smooth; }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .loader { border: 3px solid #e2e8f0; border-top: 3px solid #dc2626; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    /* Hide Scrollbar tapi tetap bisa scroll */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* Active State untuk Filter */
    .filter-btn.active { background-color: #dc2626; color: white; border-color: #dc2626; }
  </style>
</head>
<body class="text-slate-800 font-sans min-h-screen flex flex-col">

  <nav class="bg-white/90 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
          <div class="flex items-center gap-3">
              <img src="https://afbhvfhdjozvypeehgjo.supabase.co/storage/v1/object/public/TB%20PMI/logo%20temu%20bakti.png" class="h-10 w-auto">
              <div class="hidden sm:block">
                  <h1 class="font-bold text-slate-900 text-sm md:text-base leading-tight">TEMU BAKTI</h1>
                  <p class="text-[10px] md:text-xs text-red-600 font-bold tracking-wider uppercase">PMI Prov. Maluku Utara</p>
              </div>
          </div>
      </div>
  </nav>

  <div class="max-w-7xl mx-auto w-full px-4 py-6 lg:py-12 flex flex-col lg:flex-row gap-10">
      
      <main class="w-full lg:w-[70%] order-2 lg:order-1">
          
          <div class="lg:hidden sticky top-[64px] z-40 bg-[#f8fafc]/95 backdrop-blur-sm py-3 -mx-4 px-4 border-b border-slate-100/50 mb-6">
              <div class="flex gap-2 overflow-x-auto no-scrollbar">
                  <button onclick="filterNews('SEMUA')" class="filter-btn active whitespace-nowrap px-5 py-2 rounded-full border border-slate-200 text-xs font-bold bg-white text-slate-600 transition shadow-sm">Semua</button>
                  <button onclick="filterNews('Berita')" class="filter-btn whitespace-nowrap px-5 py-2 rounded-full border border-slate-200 text-xs font-bold bg-white text-slate-600 transition shadow-sm">Berita</button>
                  <button onclick="filterNews('Opini')" class="filter-btn whitespace-nowrap px-5 py-2 rounded-full border border-slate-200 text-xs font-bold bg-white text-slate-600 transition shadow-sm">Opini</button>
                  <button onclick="filterNews('Sastra')" class="filter-btn whitespace-nowrap px-5 py-2 rounded-full border border-slate-200 text-xs font-bold bg-white text-slate-600 transition shadow-sm">Sastra</button>
              </div>
          </div>

          <div id="newsContainer" class="min-h-[300px]">
              <div class="text-center py-20">
                  <div class="loader mx-auto"></div>
                  <p class="mt-4 text-slate-400 text-sm animate-pulse">Sedang memuat kabar...</p>
              </div>
          </div>
      </main>

      <aside class="w-full lg:w-[30%] order-1 lg:order-2 space-y-8">
          
          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
              <h3 class="font-bold text-slate-900 mb-4 flex items-center gap-2"><i class="bi bi-search text-red-500"></i> Cari Berita</h3>
              <div class="relative">
                  <input type="text" onkeyup="searchNews(this.value)" placeholder="Ketik kata kunci..." class="w-full bg-slate-50 border border-slate-200 rounded-xl py-3 pl-4 pr-10 text-sm outline-none focus:ring-2 focus:ring-red-500 focus:bg-white transition">
                  <i class="bi bi-search absolute right-3 top-3.5 text-slate-400"></i>
              </div>
          </div>

          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 sticky top-24 hidden lg:block">
              <h3 class="font-bold text-slate-900 mb-4 flex items-center gap-2"><i class="bi bi-funnel-fill text-red-500"></i> Kategori</h3>
              <div class="space-y-2">
                  <button onclick="filterNews('SEMUA')" class="filter-item w-full text-left px-4 py-3 rounded-xl hover:bg-slate-50 transition flex justify-between items-center group active">
                      <span class="text-sm font-semibold text-slate-600 group-hover:text-red-600">Semua Berita</span>
                      <i class="bi bi-chevron-right text-xs text-slate-300 group-hover:text-red-500"></i>
                  </button>
                  <button onclick="filterNews('Berita')" class="filter-item w-full text-left px-4 py-3 rounded-xl hover:bg-slate-50 transition flex justify-between items-center group">
                      <span class="text-sm font-semibold text-slate-600 group-hover:text-blue-600">Berita Kegiatan</span>
                      <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                  </button>
                  <button onclick="filterNews('Opini')" class="filter-item w-full text-left px-4 py-3 rounded-xl hover:bg-slate-50 transition flex justify-between items-center group">
                      <span class="text-sm font-semibold text-slate-600 group-hover:text-purple-600">Opini & Artikel</span>
                      <span class="w-2 h-2 rounded-full bg-purple-500"></span>
                  </button>
                  <button onclick="filterNews('Profil')" class="filter-item w-full text-left px-4 py-3 rounded-xl hover:bg-slate-50 transition flex justify-between items-center group">
                      <span class="text-sm font-semibold text-slate-600 group-hover:text-amber-600">Profil Tokoh</span>
                      <span class="w-2 h-2 rounded-full bg-amber-500"></span>
                  </button>
                  <button onclick="filterNews('Sastra')" class="filter-item w-full text-left px-4 py-3 rounded-xl hover:bg-slate-50 transition flex justify-between items-center group">
                      <span class="text-sm font-semibold text-slate-600 group-hover:text-pink-600">Sastra (Puisi/Cerpen)</span>
                      <span class="w-2 h-2 rounded-full bg-pink-500"></span>
                  </button>
              </div>
          </div>

          <div class="hidden mt-8 bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl p-6 text-center text-white relative overflow-hidden">
             </div>
      </aside>
  </div>

  <footer class="bg-white border-t border-slate-200 py-10 mt-auto">
      <div class="max-w-7xl mx-auto px-4 text-center md:text-left flex flex-col md:flex-row justify-between items-center gap-6">
          <div>
              <p class="text-slate-900 font-bold text-sm">© 2026 Panitia Temu Bakti</p>
              <p class="text-slate-400 text-xs mt-1">PMI Provinsi Maluku Utara</p>
          </div>
          <div class="hidden flex gap-6 text-slate-400">
             </div>
      </div>
  </footer>

  <div id="modalBerita" class="fixed inset-0 z-[100] bg-slate-900/95 backdrop-blur-sm hidden overflow-y-auto animate-fade-in">
      <div class="min-h-screen flex items-center justify-center p-4 py-10">
          <div class="bg-white w-full max-w-3xl rounded-2xl overflow-hidden shadow-2xl relative">
              <button onclick="closeBerita()" class="absolute top-4 right-4 z-20 w-10 h-10 bg-black/50 hover:bg-red-600 rounded-full text-white flex items-center justify-center transition backdrop-blur-md"><i class="bi bi-x-lg"></i></button>
              
              <div class="h-64 md:h-96 w-full bg-slate-200 relative">
                  <img id="viewFoto" class="w-full h-full object-cover">
                  <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-60"></div>
              </div>
              
              <div class="p-6 md:p-12 -mt-20 relative z-10">
                  <div class="bg-white rounded-2xl p-6 md:p-8 shadow-xl">
                      <div class="flex items-center justify-between mb-4">
                          <span id="viewKategori" class="text-[10px] font-bold text-white bg-blue-600 px-3 py-1 rounded-full uppercase tracking-wider shadow-sm">BERITA</span>
                          <span id="viewTanggal" class="text-xs font-bold text-slate-400">Tanggal</span>
                      </div>
                      
                      <h1 id="viewJudul" class="text-2xl md:text-3xl font-extrabold text-slate-900 leading-tight mb-6">Judul Berita</h1>
                      
                      <div class="flex items-center gap-3 border-b border-slate-100 pb-6 mb-6">
                          <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 overflow-hidden">
                              <i class="bi bi-person-fill text-xl"></i>
                          </div>
                          <div>
                              <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wide">Ditulis Oleh</p>
                              <p id="viewPenulis" class="text-sm font-bold text-slate-800">Nama Penulis</p>
                          </div>
                      </div>
                      
                      <div id="viewIsi" class="prose prose-lg prose-slate max-w-none text-slate-700 leading-relaxed whitespace-pre-wrap">
                          Isi konten...
                      </div>

                      <div class="mt-8 pt-8 border-t border-slate-100 text-center">
                          <button onclick="closeBerita()" class="px-8 py-3 bg-slate-100 hover:bg-slate-200 text-slate-800 rounded-xl font-bold text-sm transition">Tutup Berita</button>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <script>
    // ⚠️ Script Backend Anda ⚠️
    const GAS_NEWS_URL = "https://script.google.com/macros/s/AKfycbx693z5rUDTuE8_GrkvSeXOwt60OzIBSgQ64aMr20V00iUQz_wylG8JfMWprcfV3xOHjw/exec"; 

    let ALL_NEWS = [];
    let FILTERED_NEWS = [];
    let CURRENT_FILTER = 'SEMUA';

    window.onload = loadNews;

    async function loadNews() {
        const container = document.getElementById('newsContainer');
        try {
            const response = await fetch(GAS_NEWS_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'get_mading_public' })
            });
            const res = await response.json();

            if(res.success && res.data.length > 0) {
                ALL_NEWS = res.data;
                filterNews('SEMUA'); 
            } else {
                container.innerHTML = `<div class="text-center py-20 border-2 border-dashed border-slate-200 rounded-3xl"><i class="bi bi-journal-x text-4xl text-slate-300 mb-2 inline-block"></i><p class="text-slate-400 font-bold">Belum ada berita tayang.</p></div>`;
            }
        } catch (e) {
            container.innerHTML = `<div class="text-center py-20"><p class="text-red-400 font-bold">Gagal memuat berita. Cek koneksi.</p></div>`;
        }
    }

    function filterNews(kategori) {
        CURRENT_FILTER = kategori;
        
        // Reset styles
        document.querySelectorAll('.filter-btn').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.filter-item').forEach(el => el.classList.remove('bg-red-50', 'text-red-600'));
        
        // Active State Mobile
        const mobileBtns = document.querySelectorAll('.filter-btn');
        mobileBtns.forEach(btn => {
            if(btn.innerText.toUpperCase() === kategori.toUpperCase() || (kategori === 'SEMUA' && btn.innerText === 'Semua')) {
                btn.classList.add('active');
            }
        });

        // Active State Desktop
        const desktopItems = document.querySelectorAll('.filter-item');
        desktopItems.forEach(item => {
           if(item.innerText.toUpperCase().includes(kategori.toUpperCase()) || (kategori === 'SEMUA' && item.innerText.includes('Semua'))) {
               item.classList.add('bg-red-50', 'text-red-600');
           }
        });
        
        // Filter Logic
        if(kategori === 'SEMUA') {
            FILTERED_NEWS = ALL_NEWS;
        } else {
            FILTERED_NEWS = ALL_NEWS.filter(item => item.kategori === kategori);
        }
        
        renderNews(FILTERED_NEWS);
    }

    function searchNews(keyword) {
        const term = keyword.toLowerCase();
        FILTERED_NEWS = ALL_NEWS.filter(item => 
            item.judul.toLowerCase().includes(term) || 
            item.penulis.toLowerCase().includes(term)
        );
        renderNews(FILTERED_NEWS);
    }

    function renderNews(data) {
        const c = document.getElementById('newsContainer');
        
        if(data.length === 0) {
            c.innerHTML = `<div class="text-center py-20"><p class="text-slate-400">Tidak ditemukan berita.</p></div>`;
            return;
        }

        const showHero = (CURRENT_FILTER === 'SEMUA' && document.querySelector('input').value === '');
        const [hero, ...others] = showHero ? data : [null, ...data];
        let html = '';

        // HERO CARD
        if(showHero && hero) {
            html += `
            <div onclick="openBerita(${hero.id})" class="group cursor-pointer mb-10 relative rounded-3xl overflow-hidden shadow-xl aspect-[16/9] md:aspect-[21/9] transform hover:-translate-y-1 transition duration-500">
                <img src="${hero.foto_url}=s1200" class="w-full h-full object-cover group-hover:scale-105 transition duration-700 ease-out">
                <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/40 to-transparent"></div>
                <div class="absolute bottom-0 left-0 p-6 md:p-10 w-full md:w-3/4">
                    <div class="flex gap-2 mb-3">
                        <span class="bg-red-600 text-white text-[10px] md:text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider shadow-lg">TERBARU</span>
                        <span class="bg-white/20 backdrop-blur-md text-white text-[10px] md:text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider border border-white/20">${hero.kategori}</span>
                    </div>
                    <h2 class="text-white text-2xl md:text-4xl font-extrabold leading-tight mb-3 drop-shadow-md group-hover:text-red-200 transition">${hero.judul}</h2>
                    <div class="flex items-center gap-2 text-white/80 text-xs font-bold mt-4">
                        <div class="w-6 h-6 rounded-full bg-slate-200 border border-white/30 flex items-center justify-center text-slate-500 overflow-hidden"><i class="bi bi-person-fill"></i></div>
                        <span>${hero.penulis}</span>
                        <span class="w-1 h-1 rounded-full bg-white/50"></span>
                        <span>${formatDate(hero.created_at)}</span>
                    </div>
                </div>
            </div>`;
            html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-6">';
            others.forEach(item => html += createCard(item));
            html += '</div>';
        } else {
            html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-6">';
            data.forEach(item => html += createCard(item));
            html += '</div>';
        }
        c.innerHTML = html;
    }

    function createCard(item) {
        let badgeClass = "text-blue-600 bg-blue-50";
        if(item.kategori === 'Opini') badgeClass = "text-purple-600 bg-purple-50";
        if(item.kategori === 'Sastra') badgeClass = "text-pink-600 bg-pink-50";

        return `
        <div onclick="openBerita(${item.id})" class="bg-white rounded-2xl border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition duration-300 cursor-pointer flex flex-col h-full group overflow-hidden">
            <div class="h-48 overflow-hidden relative">
                <img src="${item.foto_url}=s500" class="w-full h-full object-cover group-hover:scale-110 transition duration-700" loading="lazy">
                <div class="absolute top-3 left-3">
                    <span class="text-[10px] font-extrabold px-2 py-1 rounded-md ${badgeClass} uppercase tracking-wider shadow-sm">${item.kategori}</span>
                </div>
            </div>
            <div class="p-5 flex-1 flex flex-col">
                <h3 class="font-bold text-slate-800 text-lg leading-snug mb-3 group-hover:text-red-600 transition line-clamp-2">${item.judul}</h3>
                <div class="mt-auto pt-4 flex items-center justify-between border-t border-slate-50 text-xs text-slate-400">
                    <span class="font-semibold text-slate-600 flex items-center gap-1">
                        <i class="bi bi-person-circle"></i> ${item.penulis.split(' ')[0]}
                    </span>
                    <span>${getTimeAgo(item.created_at)}</span>
                </div>
            </div>
        </div>`;
    }

    function openBerita(id) {
        const item = ALL_NEWS.find(i => i.id === id);
        if(!item) return;
        document.getElementById('viewFoto').src = item.foto_url;
        document.getElementById('viewKategori').innerText = item.kategori;
        document.getElementById('viewJudul').innerText = item.judul;
        document.getElementById('viewPenulis').innerText = item.penulis;
        document.getElementById('viewTanggal').innerText = formatDate(item.created_at);
        document.getElementById('viewIsi').innerText = item.isi_berita;
        document.getElementById('modalBerita').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    function closeBerita() { document.getElementById('modalBerita').classList.add('hidden'); document.body.style.overflow = 'auto'; }
    function formatDate(iso) { if(!iso) return '-'; return new Date(iso).toLocaleDateString('id-ID', {day: 'numeric', month: 'long', year: 'numeric'}); }
    function getTimeAgo(dateString) { const date = new Date(dateString); const now = new Date(); const diff = Math.floor((now - date)/1000); if(diff < 60) return 'Baru saja'; if(diff < 3600) return Math.floor(diff/60)+' mnt lalu'; if(diff < 86400) return Math.floor(diff/3600)+' jam lalu'; return formatDate(dateString); }
  </script>
</body>
</html>
